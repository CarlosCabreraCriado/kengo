@if (!isEdit()) {
  <h2 class="titulo-kengo relative my-5 h-5 w-full text-center text-3xl">
    Nuevo paciente
  </h2>
} @else {
  <h2 class="titulo-kengo relative my-5 h-5 w-full text-center text-3xl">
    Editar paciente
  </h2>
}

<form class="grid gap-3 p-2" [formGroup]="form" (ngSubmit)="onSubmit()">
  <div class="grid gap-3 md:grid-cols-2">
    <mat-form-field appearance="outline" subscriptSizing="dynamic">
      <mat-label>Nombre</mat-label>
      <input matInput formControlName="first_name" required />
    </mat-form-field>

    <mat-form-field appearance="outline" subscriptSizing="dynamic">
      <mat-label>Apellidos</mat-label>
      <input matInput formControlName="last_name" />
    </mat-form-field>
  </div>

  <mat-form-field appearance="outline" subscriptSizing="dynamic">
    <mat-label>Email</mat-label>
    <input matInput formControlName="email" type="email" required />
    <mat-error
      *ngIf="form.controls.email.invalid && form.controls.email.touched"
    >
      Email inválido
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline" subscriptSizing="dynamic">
    <mat-label>Teléfono</mat-label>
    <input matInput formControlName="telefono" />
  </mat-form-field>

  <mat-form-field appearance="outline" subscriptSizing="dynamic">
    <mat-label>Clínicas</mat-label>
    <mat-select formControlName="clinicas" multiple>
      @if (clinicasRes.isLoading()) {
        <mat-option disabled>Cargando clínicas…</mat-option>
      } @else {
        @for (c of clinicasRes.value(); track c.id_clinica) {
          <mat-option [value]="c.id_clinica">{{
            c.nombre || "Clínica " + c.id_clinica
          }}</mat-option>
        }
      }
    </mat-select>
  </mat-form-field>

  <!-- Si quieres crear con password en lugar de invitación, añade este campo
    <mat-form-field appearance="outline" subscriptSizing="dynamic">
      <mat-label>Contraseña (opcional)</mat-label>
      <input matInput type="password" formControlName="password" />
    </mat-form-field>
    -->

  <div class="mt-2 flex items-center gap-2">
    @if (isEdit()) {
      <button
        mat-flat-button
        color="primary"
        type="submit"
        [disabled]="form.invalid || loading()"
      >
        Guardar
      </button>
    } @else {
      <button
        mat-flat-button
        color="primary"
        type="submit"
        [disabled]="form.invalid || loading()"
      >
        Crear
      </button>
    }

    <button mat-button type="button" (click)="close()">Cancelar</button>
  </div>

  @if (loading()) {
    <mat-progress-bar mode="indeterminate" class="mt-2"></mat-progress-bar>
  }
  @if (error()) {
    <p class="mt-2 text-red-600">{{ error() }}</p>
  }
</form>
