<mat-sidenav-container
  class="drawer-container"
  [class.habilitar-clicks]="drawerAbierto()"
  (backdropClick)="toggle()"
>
  <mat-sidenav
    #drawer
    mode="over"
    position="end"
    class="barra-lateral"
    [disableClose]="false"
    (opened)="abrirDrawer()"
    (closed)="cerrarDrawer()"
  >
    <div class="flex h-full w-full flex-col">
      <mat-icon
        (click)="toggle()"
        class="material-symbols-outlined mt-5 ml-5 text-xl text-black"
        aria-hidden="true"
        >close</mat-icon
      >
      <!-- Cabecera paciente -->
      <div class="mt-5 w-full">
        <li class="flex flex-col items-center">
          @if (perfilUrl()) {
            <img
              [src]="perfilUrl()"
              alt=""
              class="h-28 w-28 rounded-full object-cover p-1"
            />
          } @else {
            <mat-icon
              class="material-symbols-outlined !text-zinc-400"
              aria-hidden="true"
              >person</mat-icon
            >
          }
          <h5 class="mt-1 text-xl font-semibold text-zinc-700">
            {{ pacienteNombre() }}
          </h5>
        </li>
      </div>

      <div class="mt-2 mb-5 ml-5 h-auto items-start">
        <p class="fuente-kengo">Ejercicios ({{ total() }})</p>
      </div>

      <!-- Lista de items del carrito -->
      <div class="flex w-full flex-1 flex-col overflow-auto">
        @if (svc.items().length) {
          @for (it of svc.items(); track it.ejercicio.id_ejercicio) {
            <div
              class="relative flex h-20 w-full items-center justify-between border-t px-3"
            >
              <div class="flex items-center gap-3">
                <div class="h-12 w-16 overflow-hidden rounded-md bg-gray-100">
                  @if (it.ejercicio.portada) {
                    <img
                      [src]="assetUrl(it.ejercicio.portada)"
                      class="h-full w-full object-cover"
                    />
                  }
                </div>
                <div class="flex flex-col">
                  <p class="line-clamp-2 text-sm font-medium">
                    {{ it.ejercicio.nombre_ejercicio }}
                  </p>
                  <p class="text-[11px] text-gray-500">
                    {{ it.series || "—" }}×{{ it.repeticiones || "—" }}
                    @if (it.duracion_seg) {
                      <span> • {{ it.duracion_seg }}s</span>
                    }
                    @if (it.veces_dia) {
                      <span> • {{ it.veces_dia }}/día</span>
                    }
                  </p>
                </div>
              </div>

              <button
                class="rounded-full text-sm text-gray-700 transition-all duration-200 hover:text-red-600"
                aria-label="Eliminar"
                (click)="eliminar(it.ejercicio.id_ejercicio)"
              >
                <mat-icon class="material-symbols-outlined">delete</mat-icon>
              </button>
            </div>
          }
        } @else {
          <div class="px-5 text-sm text-gray-500">
            Aún no hay ejercicios en el plan. Añádelos desde la galería.
          </div>
        }
      </div>

      <!-- Acciones -->
      <div class="mt-3 mb-5 flex w-full flex-col items-center gap-3">
        <button
          class="mt-2 inline-flex h-11 w-[85%] items-center justify-center gap-2 rounded bg-orange-500 px-6 text-sm font-medium text-white transition duration-300 hover:bg-orange-600 disabled:cursor-not-allowed disabled:bg-orange-300"
          [disabled]="!svc.items().length || !svc.paciente()"
          (click)="configurarPlan()"
        >
          <span>Configurar plan</span>
          <mat-icon class="material-symbols-outlined">arrow_forward</mat-icon>
        </button>

        <button
          class="inline-flex h-11 w-[85%] items-center justify-center gap-2 rounded bg-gray-200 px-6 text-sm font-medium text-gray-800 transition hover:bg-gray-300 disabled:cursor-not-allowed"
          (click)="cambiarPaciente()"
        >
          <span>Cambiar paciente</span>
          <mat-icon class="material-symbols-outlined">person_search</mat-icon>
        </button>
      </div>
    </div>
  </mat-sidenav>

  <mat-sidenav-content>
    <!-- Botón flotante para abrir el drawer -->
    <button
      matFab
      class="pointer-events-auto !fixed right-10 bottom-10"
      (click)="toggle()"
    >
      @if (perfilUrl()) {
        <img [src]="perfilUrl()" alt="" class="rounded-full object-cover p-1" />
      } @else {
        <mat-icon
          class="material-symbols-outlined !text-white"
          aria-hidden="true"
          >personal_injury</mat-icon
        >
      }
    </button>
  </mat-sidenav-content>
</mat-sidenav-container>
