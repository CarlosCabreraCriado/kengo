@reference "tailwindcss";

/* === Variables === */
:host {
  /* Color variables now defined globally via ThemeService */
  --kengo-glass: rgba(255, 255, 255, 0.65);
  --kengo-glass-strong: rgba(255, 255, 255, 0.85);
  --kengo-border: rgba(255, 255, 255, 0.3);
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --transition: 0.35s cubic-bezier(0.4, 0, 0.2, 1);
  display: block;
  /* Mobile: fullscreen fixed overlay */
  position: fixed;
  inset: 0;
  z-index: 100;
}

/* Desktop: normal flow, respect navigation (768px+ matches nav breakpoint) */
@media (min-width: 768px) {
  :host {
    position: relative;
    inset: auto;
    z-index: 1;
    min-height: calc(100dvh - 80px); /* Account for nav height */
  }
}

.exercise-page {
  @apply relative flex flex-col w-full h-full overflow-hidden;
}

/* Desktop: warm gradient background instead of dark */
@media (min-width: 768px) {
  .exercise-page {
    @apply overflow-y-auto;
    min-height: 100%;
  }
}

/* === Aurora === */
.aurora-bg { @apply absolute inset-0 pointer-events-none overflow-hidden opacity-30; }
.aurora-wave { @apply absolute rounded-full; filter: blur(80px); mix-blend-mode: screen; }
.aurora-wave-1 {
  @apply w-[400px] h-[400px] -top-32 -right-32;
  background: radial-gradient(circle, rgba(var(--kengo-primary-rgb), 0.5) 0%, transparent 70%);
  animation: auroraFloat1 15s ease-in-out infinite;
}
.aurora-wave-2 {
  @apply w-[300px] h-[300px] bottom-40 -left-20;
  background: radial-gradient(circle, rgba(var(--kengo-tertiary-rgb), 0.4) 0%, transparent 70%);
  animation: auroraFloat2 12s ease-in-out infinite;
}
@keyframes auroraFloat1 { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(-40px, 60px) scale(1.2); } }
@keyframes auroraFloat2 { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(50px, -40px) scale(1.15); } }

/* Desktop: hide aurora, use gradient bg instead */
@media (min-width: 768px) {
  .aurora-bg { @apply hidden; }
}

/* === States === */
.loading-container, .error-container { @apply flex-1 flex items-center justify-center p-6; }
.loading-card, .error-card {
  @apply relative p-12 rounded-3xl text-center overflow-hidden;
  background: var(--kengo-glass);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--kengo-border);
}
.shimmer-effect {
  @apply absolute inset-0;
  background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.4) 50%, transparent 100%);
  background-size: 200% 100%;
  animation: shimmer 1.8s infinite;
}
@keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
.loading-icon, .error-icon {
  @apply w-20 h-20 mx-auto rounded-2xl flex items-center justify-center;
  background: linear-gradient(135deg, rgba(var(--kengo-primary-rgb), 0.15) 0%, rgba(var(--kengo-tertiary-rgb), 0.1) 100%);
}
.loading-icon { animation: pulse 2s ease-in-out infinite; }
.loading-icon .material-symbols-outlined, .error-icon .material-symbols-outlined { @apply text-5xl; color: var(--kengo-primary); }
.error-icon { @apply bg-red-50; }
.error-icon .material-symbols-outlined { @apply text-red-400; }
@keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.08); opacity: 0.7; } }
.loading-text { @apply relative text-sm text-zinc-500 mt-5 font-medium; }
.error-text { @apply text-zinc-600 mt-4 mb-6; }
.error-btn { @apply inline-flex items-center gap-2 px-5 py-3 rounded-xl border-[1.5px] border-zinc-300 text-zinc-700 font-medium cursor-pointer transition-all; }
.error-btn:hover { @apply border-zinc-300; border-color: var(--kengo-primary); color: var(--kengo-primary); }

/* === Header === */
.floating-header {
  @apply absolute top-0 left-0 right-0 z-50 flex items-center justify-between;
  padding: calc(var(--safe-top) + 12px) 16px 12px;
  background: linear-gradient(180deg, rgba(0, 0, 0, 0.5) 0%, transparent 100%);
  transition: background var(--transition);
}
.floating-header.scrolled { background: linear-gradient(180deg, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0.3) 100%); }
.header-btn {
  @apply flex items-center justify-center w-11 h-11 rounded-full cursor-pointer transition-all active:scale-90;
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.2);
}
.header-btn .material-symbols-outlined { @apply text-white text-xl; }
.header-btn:hover { background: rgba(255, 255, 255, 0.25); transform: scale(1.05); }
.header-center { @apply flex-1 mx-4 text-center opacity-0; transform: translateY(-8px); transition: all var(--transition); }
.header-center.visible { @apply opacity-100; transform: translateY(0); }
.header-title { @apply text-white text-lg truncate; }

/* Hide mobile header on desktop */
@media (min-width: 768px) {
  .floating-header {
    @apply hidden;
  }
}

/* Desktop back button with text */
.back-btn-desktop {
  @apply inline-flex items-center gap-2 mb-4 px-4 py-2.5 rounded-xl
         text-sm font-medium text-zinc-600
         cursor-pointer transition-all active:scale-95;
  background: rgba(255, 255, 255, 0.7);
  border: 1px solid rgba(0, 0, 0, 0.08);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
}

.back-btn-desktop:hover {
  background: rgba(255, 255, 255, 0.95);
  transform: translateX(-4px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  color: var(--kengo-primary);
}

.back-btn-desktop .material-symbols-outlined {
  @apply text-lg;
  transition: transform 0.2s ease;
}

.back-btn-desktop:hover .material-symbols-outlined {
  transform: translateX(-2px);
}

/* Desktop Header Card */
.desktop-header-card {
  @apply flex items-center gap-4 mt-6 p-4 mx-6 rounded-2xl;
  max-width: 1400px;
  padding-left: 2rem;
  padding-right: 2rem;
  background: var(--kengo-glass-strong);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border: 1px solid var(--kengo-border);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
}

.desktop-header-card .back-btn-desktop {
  @apply mb-0 shrink-0;
}

.desktop-header-title {
  @apply flex flex-col gap-1 min-w-0;
}

.desktop-header-title h1 {
  @apply text-2xl truncate;
  color: var(--kengo-primary);
}

.desktop-header-meta {
  @apply inline-flex items-center gap-2;
}

.desktop-header-meta .meta-badge {
  @apply inline-flex items-center gap-1 text-sm font-medium text-zinc-600;
}

.desktop-header-meta .meta-badge .material-symbols-outlined {
  @apply text-sm;
  color: var(--kengo-primary);
}

.desktop-header-meta .meta-divider {
  @apply text-zinc-400 text-sm;
}

@media (min-width: 1024px) {
  .desktop-header-card {
    @apply gap-6 p-5;
  }

  .desktop-header-title h1 {
    @apply text-3xl;
  }
}

/* === Media === */
.media-container { @apply relative flex-shrink-0 overflow-hidden cursor-pointer; height: 55dvh; transition: height var(--transition); }
.media-container.expanded { height: calc(100dvh - 120px - var(--safe-bottom)); }
.media-video, .media-image { @apply absolute inset-0 w-full h-full object-cover; transition: transform 0.6s ease, opacity 0.3s ease; }

/* Video placeholder with spinner */
.video-placeholder {
  @apply absolute inset-0 flex items-center justify-center;
  background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
}

.video-placeholder::after {
  content: "";
  width: 40px;
  height: 40px;
  border: 3px solid rgba(var(--kengo-primary-rgb), 0.2);
  border-top-color: rgba(var(--kengo-primary-rgb), 0.7);
  border-radius: 50%;
  animation: videoSpin 1s linear infinite;
}

@keyframes videoSpin {
  to { transform: rotate(360deg); }
}
.media-container:hover .media-video, .media-container:hover .media-image { transform: scale(1.02); }
.media-placeholder { @apply flex items-center justify-center w-full h-full; background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%); }
.media-placeholder .material-symbols-outlined { @apply text-8xl text-zinc-700; }
.media-overlay { @apply absolute inset-0 pointer-events-none; background: linear-gradient(180deg, transparent 0%, transparent 50%, rgba(0, 0, 0, 0.4) 80%, rgba(0, 0, 0, 0.7) 100%); }
.play-indicator { @apply absolute inset-0 flex items-center justify-center pointer-events-none; animation: playPop 0.6s ease-out forwards; }
.play-indicator .material-symbols-outlined { @apply text-white; font-size: 5rem; text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5); }
@keyframes playPop { 0% { opacity: 0; transform: scale(0.5); } 30% { opacity: 1; transform: scale(1.1); } 100% { opacity: 0; transform: scale(1.3); } }
.swipe-hint { @apply absolute bottom-10 inset-x-0 flex flex-col items-center gap-1 text-white/70 pointer-events-none; animation: hintBounce 2s ease-in-out infinite; }
.swipe-hint .material-symbols-outlined { @apply text-2xl; }
.hint-text { @apply text-xs font-medium; }
@keyframes hintBounce { 0%, 100% { transform: translateY(0); opacity: 0.7; } 50% { transform: translateY(-8px); opacity: 1; } }

/* Desktop: video in a contained card, not full-screen */
@media (min-width: 768px) {
  .media-container {
    @apply rounded-3xl shadow-2xl;
    height: auto;
    aspect-ratio: 16 / 9;
    max-height: 70vh;
  }
  .media-container.expanded {
    height: auto;
    aspect-ratio: 16 / 9;
    max-height: 80vh;
  }
  .media-overlay {
    background: linear-gradient(180deg, transparent 0%, transparent 70%, rgba(0, 0, 0, 0.3) 100%);
    border-radius: 1.5rem;
  }
  .media-video, .media-image {
    @apply rounded-3xl;
  }
  .media-placeholder {
    @apply rounded-3xl;
    background: linear-gradient(135deg, #f3eceb 0%, #ffede8 100%);
  }
  .media-placeholder .material-symbols-outlined { @apply text-zinc-300; }
  .video-placeholder {
    background: linear-gradient(135deg, #f3eceb 0%, #ffede8 100%);
    @apply rounded-3xl;
  }
  .swipe-hint { @apply hidden; }
}

/* === Bottom Panel === */
.bottom-panel {
  @apply relative flex-1 flex flex-col z-10 overflow-hidden;
  border-radius: 28px 28px 0 0;
  background: var(--kengo-glass);
  backdrop-filter: blur(24px);
  -webkit-backdrop-filter: blur(24px);
  border: 1px solid var(--kengo-border);
  border-bottom: none;
  box-shadow: 0 -8px 40px rgba(0, 0, 0, 0.15);
  margin-top: -24px;
  transition: all var(--transition);
}
.bottom-panel.minimized { @apply flex-shrink-0; flex: 0 0 auto; }
.panel-handle { @apply flex justify-center py-3 cursor-pointer; }
.handle-bar { @apply w-12 h-1.5 rounded-full bg-zinc-300/60; transition: all 0.2s ease; }
.panel-handle:hover .handle-bar { @apply bg-zinc-400 w-16; }

/* Desktop: panel as a side card, not bottom sheet */
@media (min-width: 768px) {
  .bottom-panel {
    @apply rounded-3xl flex-none overflow-y-auto;
    border-radius: 1.5rem;
    border: 1px solid var(--kengo-border);
    box-shadow: 0 8px 40px rgba(0, 0, 0, 0.1);
    margin-top: 0;
    max-height: calc(100vh - 160px);
    background: var(--kengo-glass-strong);
  }
  .bottom-panel.minimized {
    @apply flex-1;
  }
  .panel-handle { @apply hidden; }
}

/* === Content === */
.exercise-content { @apply flex-1 overflow-y-auto px-5 pb-4; scrollbar-width: none; -ms-overflow-style: none; }
.exercise-content::-webkit-scrollbar { display: none; }
.animate-content { animation: slideUp 0.4s ease-out; }
@keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
.exercise-header { @apply text-center mb-5; }
.exercise-title { @apply text-2xl mb-3; color: var(--kengo-primary); }
.exercise-meta { @apply inline-flex items-center gap-2 px-4 py-2 rounded-2xl; background: rgba(var(--kengo-primary-rgb), 0.08); border: 1px solid rgba(var(--kengo-primary-rgb), 0.15); }
.meta-badge { @apply inline-flex items-center gap-1.5 text-sm font-semibold text-zinc-700; }
.meta-badge .material-symbols-outlined { @apply text-base; color: var(--kengo-primary); }
.meta-divider { @apply text-zinc-400 font-bold; }

/* === Presets (Series/Repeticiones) === */
.preset-selector { @apply flex flex-col items-center gap-3 mb-5; }
.preset-label { @apply text-xs font-semibold text-zinc-400 uppercase tracking-wider; }
.preset-chips { @apply flex items-center gap-2 flex-wrap justify-center; }
.preset-chip { @apply px-4 py-2 rounded-full text-sm font-semibold cursor-pointer transition-all active:scale-95; background: rgba(255, 255, 255, 0.6); border: 1.5px solid rgba(0, 0, 0, 0.08); color: #64748b; }
.preset-chip:hover { background: rgba(255, 255, 255, 0.9); border-color: rgba(var(--kengo-primary-rgb), 0.3); color: var(--kengo-primary); }
.preset-chip.active { background: linear-gradient(135deg, var(--kengo-primary) 0%, var(--kengo-primary-dark) 100%); border-color: transparent; color: white; box-shadow: var(--kengo-shadow-primary); }
.preset-input {
  @apply w-16 px-2 py-2 rounded-xl text-sm font-semibold text-center;
  background: rgba(255, 255, 255, 0.9);
  border: 1.5px solid rgba(var(--kengo-primary-rgb), 0.3);
  color: var(--kengo-primary);
  outline: none;
}
.preset-input:focus {
  border-color: var(--kengo-primary);
  box-shadow: 0 0 0 3px rgba(var(--kengo-primary-rgb), 0.15);
}

/* === Description === */
.description-card { @apply rounded-2xl overflow-hidden; background: rgba(255, 255, 255, 0.5); border: 1px solid rgba(255, 255, 255, 0.4); }
.description-header { @apply flex items-center gap-2 px-4 py-3 text-sm font-semibold text-zinc-600; background: rgba(255, 255, 255, 0.4); border-bottom: 1px solid rgba(0, 0, 0, 0.05); }
.description-header .material-symbols-outlined { @apply text-lg; color: var(--kengo-primary); }
.description-content { @apply px-4 py-3 text-sm text-zinc-600 leading-relaxed; }
.description-content p { @apply mb-2 last:mb-0; }

/* === Actions === */
.actions-bar { @apply flex items-center justify-center gap-4 px-5 py-4 shrink-0; padding-bottom: calc(var(--safe-bottom) + 16px); transition: all var(--transition); }
.actions-bar.compact { @apply flex-col gap-3 py-3; padding-bottom: calc(var(--safe-bottom) + 12px); }
.minimal-info { @apply w-full text-center mb-1; }
.minimal-title { @apply text-base font-semibold text-zinc-700 truncate block px-4; }
.action-buttons { @apply flex items-center justify-center gap-4; }
.action-btn { @apply flex items-center justify-center gap-2 cursor-pointer transition-all active:scale-95; border: none; }
.action-btn.secondary { @apply w-12 h-12 rounded-full; background: rgba(255, 255, 255, 0.7); border: 1px solid rgba(0, 0, 0, 0.08); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
.action-btn.secondary .material-symbols-outlined { @apply text-xl text-zinc-600; }
.action-btn.secondary:hover { background: rgba(255, 255, 255, 0.95); transform: translateY(-2px); }
.action-btn.secondary:hover .material-symbols-outlined { color: var(--kengo-primary); }
.action-btn.primary { @apply h-14 px-6 rounded-2xl text-white font-semibold; background: linear-gradient(135deg, var(--kengo-primary) 0%, var(--kengo-primary-dark) 100%); box-shadow: var(--kengo-shadow-primary); }
.action-btn.primary .material-symbols-outlined { @apply text-2xl; }
.action-btn.primary:hover { transform: translateY(-3px) scale(1.02); box-shadow: 0 8px 28px rgba(var(--kengo-primary-rgb), 0.5); }
.btn-label { @apply text-base; }
.actions-bar.compact .action-btn.primary { @apply w-16 h-16 px-0 rounded-full; }
.actions-bar.compact .action-btn.primary .btn-label { @apply hidden; }

.icon-filled { font-variation-settings: "FILL" 1, "wght" 400, "GRAD" 0, "opsz" 24; }

/* === Desktop Two-Column Layout (768px+ to match navigation breakpoint) === */
@media (min-width: 768px) {
  /* Main layout container for desktop */
  .desktop-layout {
    @apply flex gap-6 items-start;
    max-width: 1400px;
    margin: 0 auto;
    padding: 1.5rem 2rem 2rem;
  }

  /* Video column */
  .desktop-video-column {
    @apply flex-1 sticky;
    top: 1.5rem;
    min-width: 0;
  }

  /* Info column - narrower on tablet */
  .desktop-info-column {
    @apply w-[320px] flex-shrink-0;
  }

  /* Always show content on desktop */
  .exercise-content {
    @apply px-5 py-2;
    animation: none;
  }

  .exercise-header {
    @apply text-center mb-5;
  }

  .exercise-title {
    @apply text-2xl mb-3;
  }

  .exercise-meta {
    @apply inline-flex;
  }

  .preset-selector {
    @apply flex-col items-center gap-3 mb-5;
  }

  .preset-chips {
    @apply flex-wrap justify-center;
  }

  .preset-chip {
    @apply px-4 py-2 text-sm;
  }

  .description-card {
    @apply mb-5;
  }

  /* Actions at bottom of info panel */
  .actions-bar {
    @apply flex-row justify-start gap-3 px-5 py-4 border-t border-zinc-200/50;
    padding-bottom: 1.25rem;
  }

  .actions-bar.compact {
    @apply flex-row py-4;
    padding-bottom: 1.25rem;
  }

  .minimal-info {
    @apply hidden;
  }

  .action-buttons {
    @apply w-full justify-center;
  }

  .action-btn.secondary {
    @apply w-11 h-11;
  }

  .action-btn.primary {
    @apply h-12 px-6 flex-1 max-w-[200px];
  }

  .action-btn.primary .btn-label {
    @apply inline text-sm;
  }

  /* Hide mobile-only elements */
  .actions-bar .action-btn.secondary:has(.material-symbols-outlined:is([class*="expand"])) {
    @apply hidden;
  }
}

/* Larger desktop (1024px+): more spacious layout */
@media (min-width: 1024px) {
  .desktop-layout {
    @apply gap-8;
    padding: 1.5rem 2rem 2rem;
  }

  .desktop-info-column {
    @apply w-[420px];
  }

  .exercise-content {
    @apply px-6;
  }

  .exercise-header {
    @apply mb-6;
  }

  .exercise-title {
    @apply text-3xl mb-4;
  }

  .preset-selector {
    @apply gap-4 mb-6;
  }

  .preset-chip {
    @apply px-5 py-2.5;
  }

  .description-card {
    @apply mb-6;
  }

  .actions-bar {
    @apply gap-4 px-6 py-5;
    padding-bottom: 1.5rem;
  }

  .action-btn.secondary {
    @apply w-12 h-12;
  }

  .action-btn.primary {
    @apply h-14 px-8 max-w-xs;
  }

  .action-btn.primary .btn-label {
    @apply text-base;
  }
}

/* === Modo Rutina (crear plantilla) === */
.action-btn.primary.rutina-mode {
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  box-shadow: 0 6px 24px rgba(245, 158, 11, 0.4);
}

.action-btn.primary.rutina-mode:hover {
  box-shadow: 0 8px 28px rgba(245, 158, 11, 0.5);
}
