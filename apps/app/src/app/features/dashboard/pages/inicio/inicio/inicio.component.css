@reference "tailwindcss";

:host {
  /* Color variables now defined globally via ThemeService */
  --kengo-success: #22c55e;
  --kengo-glass: rgba(255, 255, 255, 0.5);
  --kengo-glass-strong: rgba(255, 255, 255, 0.7);
  --kengo-border: rgba(255, 255, 255, 0.25);
  --kengo-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
  --safe-area-bottom: env(safe-area-inset-bottom, 0px);
  display: flex;
  flex-direction: column;
  flex: 1;
  min-height: 0;
  overflow: hidden;
  width: 100%;
}

.dashboard-page {
  @apply relative flex h-full w-full flex-col overflow-x-hidden overflow-y-auto;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
}

/* ============================================
   HEADER
   ============================================ */
.dashboard-header {
  @apply sticky top-0 z-50 w-full shrink-0;
  padding: env(safe-area-inset-top, 12px) 16px 12px;
  /* Desktop: transparente, móvil aplica glassmorphism vía media query */
  background: transparent;
  backdrop-filter: none;
  -webkit-backdrop-filter: none;
}

/* Glassmorphism y padding aumentado en móvil */
@media (max-width: 767.98px) {
  .dashboard-header {
    padding: calc(env(safe-area-inset-top, 0px) + 20px) 20px 16px;
    background: linear-gradient(
      to bottom,
      rgba(254, 248, 247, 0.95) 0%,
      rgba(254, 248, 247, 0.85) 60%,
      rgba(254, 248, 247, 0) 100%
    );
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
  }
}

.header-content {
  @apply mx-auto flex max-w-5xl items-center justify-between;
}

.logo {
  @apply h-9;
}

.avatar-btn {
  @apply flex h-10 w-10 cursor-pointer items-center justify-center overflow-hidden rounded-full border-2 border-white shadow-md transition-all active:scale-95;
  background: linear-gradient(
    to bottom right,
    var(--kengo-primary),
    var(--kengo-tertiary)
  );
}

.avatar-btn .avatar-img {
  @apply h-full w-full object-cover;
}

.avatar-btn .material-symbols-outlined {
  @apply text-xl text-white;
}

.avatar-btn.menu-open {
  @apply ring-2 ring-offset-2;
  --tw-ring-color: rgba(var(--kengo-primary-rgb), 0.5);
}

/* Avatar Menu Container */
.avatar-menu-container {
  @apply relative;
}

/* Menú desplegable de usuario */
.user-menu {
  @apply absolute top-full right-0 z-[100] mt-2 flex w-48 flex-col overflow-hidden rounded-2xl;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.5);
  box-shadow:
    0 10px 40px rgba(0, 0, 0, 0.15),
    0 2px 10px rgba(0, 0, 0, 0.1);
  animation: menuSlideIn 0.2s ease-out;
}

@keyframes menuSlideIn {
  from {
    opacity: 0;
    transform: translateY(-8px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.menu-item {
  @apply flex w-full cursor-pointer items-center gap-3 border-none bg-transparent px-4 py-3 text-left text-sm font-medium text-zinc-700 transition-all;
}

.menu-item:hover {
  @apply bg-zinc-100;
}

.menu-item:active {
  @apply bg-zinc-200;
}

.menu-item .material-symbols-outlined {
  @apply text-xl text-zinc-500;
}

.menu-item:hover .material-symbols-outlined {
  color: var(--kengo-primary);
}

.menu-item-danger {
  @apply border-t border-zinc-100 text-red-600;
}

.menu-item-danger .material-symbols-outlined {
  @apply text-red-500;
}

.menu-item-danger:hover {
  @apply bg-red-50;
}

.menu-item-danger:hover .material-symbols-outlined {
  @apply text-red-600;
}

/* Backdrop para cerrar menú */
.menu-backdrop {
  @apply fixed inset-0 z-[99];
}

/* Desktop Greeting Section */
.greeting-section {
  @apply flex items-center gap-4;
}

.user-avatar-large {
  @apply flex h-14 w-14 items-center justify-center overflow-hidden rounded-2xl border-[3px] border-white shadow-lg;
  background: linear-gradient(
    to bottom right,
    var(--kengo-primary),
    var(--kengo-tertiary)
  );
}

.user-avatar-large img {
  @apply h-full w-full object-cover;
}

.user-avatar-large .material-symbols-outlined {
  @apply text-3xl text-white;
}

.greeting-text {
  @apply flex flex-col;
}

.greeting-name {
  @apply m-0 text-2xl;
  color: var(--kengo-primary);
}

.greeting-subtitle {
  @apply m-0 mt-0.5 text-sm text-zinc-500;
}

/* ============================================
   MAIN CONTENT
   ============================================ */
.dashboard-main {
  @apply relative z-10 flex flex-1 flex-col gap-4 px-4 pt-2;
  padding-bottom: calc(var(--safe-area-bottom) + 100px);
  max-width: 1200px;
  margin: 0 auto;
  width: 100%;
}

/* ============================================
   GREETING CARD (Mobile)
   ============================================ */
.greeting-card {
  @apply relative overflow-hidden rounded-3xl p-5;
  background: var(--kengo-glass);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border: 1px solid var(--kengo-border);
  box-shadow: var(--kengo-shadow);
  min-height: 100px;
}

.greeting-card-content {
  @apply relative z-10;
}

.greeting-title {
  @apply m-0 text-2xl;
  color: var(--kengo-primary);
}

.greeting-message {
  @apply m-0 mt-1 text-sm text-zinc-600;
}

.greeting-decoration {
  @apply pointer-events-none absolute right-0 bottom-0 h-full w-1/2;
}

.bonsai-small {
  @apply absolute right-[-10%] bottom-[-10%] h-[140%] w-auto object-contain opacity-30;
}

/* ============================================
   ACTIVITY HERO CARD
   ============================================ */
.activity-hero {
  @apply relative cursor-pointer overflow-hidden rounded-3xl transition-all;
  background: var(--kengo-glass);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border: 1px solid var(--kengo-border);
  box-shadow: var(--kengo-shadow);
  min-height: 200px;
}

.activity-hero:hover {
  @apply -translate-y-1;
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.18);
}

.activity-hero:active {
  @apply scale-[0.99];
}

/* Activity Background */
.activity-bg {
  @apply absolute inset-0 overflow-hidden;

  /* State-based colors */
  --wave-color-1: rgba(var(--kengo-primary-rgb), 0.3);
  --wave-color-2: rgba(var(--kengo-tertiary-rgb), 0.25);
  --wave-duration: 10s;
}

.activity-hero[data-state="pending"] .activity-bg {
  --wave-color-1: rgba(var(--kengo-primary-rgb), 0.4);
  --wave-color-2: rgba(255, 120, 80, 0.3);
  --wave-duration: 6s;
}

.activity-hero[data-state="completed"] .activity-bg {
  --wave-color-1: rgba(var(--kengo-tertiary-rgb), 0.4);
  --wave-color-2: rgba(134, 239, 172, 0.3);
  --wave-duration: 14s;
}

.activity-hero[data-state="rest"] .activity-bg {
  --wave-color-1: rgba(148, 163, 184, 0.3);
  --wave-color-2: rgba(165, 180, 200, 0.25);
  --wave-duration: 18s;
}

.activity-wave {
  @apply absolute rounded-full;
  filter: blur(50px);
  mix-blend-mode: multiply;
}

.activity-wave-1 {
  @apply -top-12 -right-12 h-[200px] w-[200px];
  background: radial-gradient(circle, var(--wave-color-1) 0%, transparent 70%);
  animation: activityFloat1 var(--wave-duration) ease-in-out infinite;
}

.activity-wave-2 {
  @apply bottom-0 left-1/4 h-[160px] w-[160px];
  background: radial-gradient(circle, var(--wave-color-2) 0%, transparent 70%);
  animation: activityFloat2 var(--wave-duration) ease-in-out infinite;
  animation-delay: calc(var(--wave-duration) * -0.33);
}

@keyframes activityFloat1 {
  0%,
  100% {
    transform: translate(0, 0) scale(1);
    opacity: 0.7;
  }
  50% {
    transform: translate(-20px, 30px) scale(1.1);
    opacity: 0.9;
  }
}

@keyframes activityFloat2 {
  0%,
  100% {
    transform: translate(0, 0) scale(1);
    opacity: 0.6;
  }
  50% {
    transform: translate(30px, -20px) scale(1.15);
    opacity: 0.8;
  }
}

.bonsai-hero {
  @apply pointer-events-none absolute right-[-5%] bottom-0 h-[120%] w-auto object-contain opacity-20;
  transition:
    transform 0.5s ease,
    opacity 0.3s ease;
}

.activity-hero:hover .bonsai-hero {
  @apply opacity-30;
  transform: scale(1.05) translateX(-5px);
}

/* Activity Badge */
.activity-badge {
  @apply absolute top-4 right-4 z-20 flex items-center gap-1.5 rounded-2xl px-3 py-1.5;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  animation: fadeInScale 0.3s ease-out;
}

.activity-badge[data-type="loading"] {
  @apply bg-white/30;
  backdrop-filter: blur(8px);
}

.activity-badge[data-type="pending"] {
  background: linear-gradient(
    135deg,
    var(--kengo-primary) 0%,
    var(--kengo-primary-dark) 100%
  );
}

.activity-badge[data-type="completed"] {
  background: linear-gradient(135deg, var(--kengo-tertiary) 0%, #d4a93d 100%);
}

.activity-badge[data-type="rest"] {
  @apply bg-slate-500/80;
  backdrop-filter: blur(8px);
}

.badge-spinner {
  @apply h-5 w-5 rounded-full;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-top-color: white;
  animation: spin 0.8s linear infinite;
}

.badge-number {
  @apply text-lg leading-none font-bold text-white;
}

.badge-label {
  @apply text-xs text-white/80;
}

.activity-badge .material-symbols-outlined {
  @apply text-xl text-white;
}

@keyframes fadeInScale {
  from {
    opacity: 0;
    transform: scale(0.8);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/* Activity Content */
.activity-content {
  @apply relative z-10 flex flex-col gap-3 p-5;
}

.activity-info {
  @apply flex flex-col;
}

.activity-title {
  @apply m-0 text-lg font-semibold text-zinc-800;
}

.activity-subtitle {
  @apply m-0 mt-0.5 text-sm text-zinc-500;
}

/* Progress */
.activity-progress {
  @apply flex items-center gap-3;
}

.progress-track {
  @apply h-2 flex-1 overflow-hidden rounded-full bg-black/10;
}

.progress-fill {
  @apply h-full rounded-full transition-all duration-500;
  background: linear-gradient(
    90deg,
    var(--kengo-primary) 0%,
    var(--kengo-tertiary) 100%
  );
}

.progress-text {
  @apply text-xs font-medium whitespace-nowrap text-zinc-500;
}

/* Next Exercise */
.next-exercise {
  @apply flex items-center gap-2 text-sm font-medium;
  color: var(--kengo-primary);
}

.next-exercise .material-symbols-outlined {
  @apply text-base;
}

/* Activity CTA */
.activity-cta {
  @apply flex h-12 w-full cursor-pointer items-center justify-center gap-2 rounded-xl font-semibold text-white transition-all active:scale-[0.98];
  background: linear-gradient(
    135deg,
    var(--kengo-primary) 0%,
    var(--kengo-primary-dark) 100%
  );
  box-shadow: var(--kengo-shadow-primary);
}

.activity-cta:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 24px rgba(var(--kengo-primary-rgb), 0.45);
}

.activity-cta .material-symbols-outlined {
  @apply text-xl;
}

/* Completed State */
.activity-completed {
  @apply flex h-12 w-full items-center justify-center gap-2 rounded-xl font-semibold text-white;
  background: linear-gradient(135deg, var(--kengo-tertiary) 0%, #d4a93d 100%);
  box-shadow: 0 4px 16px rgba(var(--kengo-tertiary-rgb), 0.35);
}

.activity-completed .material-symbols-outlined {
  @apply text-xl;
}

/* ============================================
   ACTIONS SECTION
   ============================================ */
.actions-section {
  @apply flex flex-col gap-3;
}

.section-title {
  @apply m-0 px-1 text-sm font-semibold tracking-wide text-zinc-500 uppercase;
}

.actions-grid {
  @apply grid grid-cols-1 gap-3;
}

/* Action Card */
.action-card {
  @apply relative flex cursor-pointer items-center gap-4 rounded-2xl p-3 transition-all;
  background: var(--kengo-glass);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: 1px solid var(--kengo-border);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
}

.action-card:hover {
  @apply -translate-y-0.5 bg-white/70;
  box-shadow: var(--kengo-shadow);
}

.action-card:active {
  @apply scale-[0.99];
}

.action-image {
  @apply relative h-16 w-16 shrink-0 overflow-hidden rounded-xl;
}

.action-image img {
  @apply h-full w-full object-cover transition-transform duration-300;
}

.action-card:hover .action-image img {
  transform: scale(1.1);
}

.action-content {
  @apply flex min-w-0 flex-1 flex-col;
}

.action-title {
  @apply m-0 truncate text-base;
  color: var(--kengo-primary);
}

.action-subtitle {
  @apply m-0 mt-0.5 truncate text-xs text-zinc-500;
}

.action-arrow {
  @apply flex h-8 w-8 shrink-0 items-center justify-center rounded-full transition-all;
  background-color: rgba(var(--kengo-primary-rgb), 0.1);
  color: var(--kengo-primary);
}

.action-card:hover .action-arrow {
  @apply text-white;
  background-color: var(--kengo-primary);
}

.action-arrow .material-symbols-outlined {
  @apply text-lg;
}

/* ============================================
   CAROUSEL (Alternative - Hidden)
   ============================================ */
.carousel-wrapper {
  @apply flex flex-1 flex-col;
}

.carousel {
  @apply flex flex-1 items-center gap-4 overflow-x-auto overflow-y-hidden px-[5%] py-8;
  scroll-snap-type: x mandatory;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
  -ms-overflow-style: none;
}

.carousel::-webkit-scrollbar {
  display: none;
}

.carousel-card {
  @apply relative h-[calc(100%-2rem)] w-[90%] flex-none cursor-pointer overflow-hidden rounded-3xl;
  scroll-snap-align: center;
  scroll-snap-stop: always;
  background: var(--kengo-glass);
  backdrop-filter: blur(16px);
  border: 1px solid var(--kengo-border);
  box-shadow: var(--kengo-shadow);
}

.carousel-image {
  @apply absolute inset-0 h-full w-full object-cover;
}

.carousel-overlay {
  @apply absolute inset-0;
  background: linear-gradient(
    180deg,
    transparent 50%,
    #f9b87e 75%,
    var(--kengo-primary) 100%
  );
}

.carousel-content {
  @apply absolute right-0 bottom-0 left-0 z-10 p-6;
}

.carousel-title {
  @apply m-0 text-2xl;
  color: var(--kengo-primary-dark);
}

.carousel-subtitle {
  @apply m-0 mt-1 text-base text-white;
}

.pagination-dots {
  @apply flex shrink-0 justify-center gap-2 py-4;
}

.dot {
  @apply h-2 w-2 cursor-pointer rounded-full p-0 transition-all;
  background-color: rgba(var(--kengo-primary-rgb), 0.3);
}

.dot:hover {
  background-color: rgba(var(--kengo-primary-rgb), 0.5);
}

.dot.active {
  @apply w-6;
  background-color: var(--kengo-primary);
  border-radius: 4px;
}

/* ============================================
   UTILITIES
   ============================================ */
.icon-filled {
  font-variation-settings:
    "FILL" 1,
    "wght" 400,
    "GRAD" 0,
    "opsz" 24;
}

/* ============================================
   ANIMATIONS
   ============================================ */
.animate-in {
  animation: fadeInUp 0.4s ease-out forwards;
  animation-delay: var(--delay, 0s);
  opacity: 0;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(16px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ============================================
   DESKTOP LAYOUT
   ============================================ */
@media (min-width: 768px) {
  .actions-grid {
    @apply grid-cols-2;
  }

  /* Ocultar tarjeta de saludo en desktop (navegación ya provee contexto) */
  .greeting-card {
    @apply hidden;
  }

  /* Header con más padding en desktop */
  .dashboard-header {
    @apply py-5;
  }
}

@media (min-width: 1024px) {
  .dashboard-header {
    @apply py-6;
  }

  .dashboard-main {
    @apply gap-6 px-8 pt-0;
    padding-bottom: 32px;
  }

  /* Activity Hero - larger on desktop */
  .activity-hero {
    min-height: 240px;
  }

  .activity-content {
    @apply p-6;
  }

  .activity-title {
    @apply text-xl;
  }

  .bonsai-hero {
    @apply h-[140%] opacity-25;
  }

  /* Actions Grid - 3 columns */
  .actions-grid {
    @apply grid-cols-3;
  }

  .action-card {
    @apply p-4;
  }

  .action-image {
    @apply h-20 w-20 rounded-2xl;
  }

  .action-title {
    @apply text-lg;
  }

  .action-subtitle {
    @apply text-sm;
  }
}

@media (min-width: 1280px) {
  .dashboard-main {
    @apply gap-8;
  }

  .activity-hero {
    min-height: 280px;
  }

  .activity-content {
    @apply p-8;
  }

  .activity-title {
    @apply text-2xl;
  }

  .actions-grid {
    @apply gap-4;
  }

  .action-card {
    @apply gap-5 p-5;
  }

  .action-image {
    @apply h-24 w-24;
  }
}
